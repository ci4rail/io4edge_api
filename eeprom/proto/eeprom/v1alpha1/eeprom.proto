/*
Copyright Â© 2022 Ci4Rail GmbH <engineering@ci4rail.com>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
syntax = "proto3";

package eeprom;
option go_package = "eeprom/v1alpha1";

// ============= Configuration =================

// ConfigurationSet to pass to Functionblock.Configuration.functionSpecificConfigurationSet hook
message ConfigurationSet {
    // Block size for read/write operations (default 32 bytes)
    fixed32 block_size = 1;

    // Write protection flag
    bool write_protected = 2;

    // EEPROM identification string (optional, for future use)
    string ident = 3;

    // Auto-protect flag: if true, the EEPROM will automatically set write protection after a write operation
    bool auto_protect = 4;
}

// ConfigurationSetResponse to pass to Functionblock.Configuration.functionSpecificConfigurationSetResponse hook
message ConfigurationSetResponse {
    // no parameters
}

// ConfigurationGet to pass to Functionblock.Configuration.functionSpecificConfigurationGet hook
message ConfigurationGet {
    // no parameters
}

// ConfigurationGetResponse to pass to Functionblock.ConfigurationGetResponse.functionSpecificConfigurationGetResponse hook
// Returns the current EEPROM configuration
message ConfigurationGetResponse {
    fixed32 block_size = 1;
    bool write_protected = 2;
    string ident = 3;
    bool auto_protect = 4;
}

// ConfigurationDescribe to pass to Functionblock.Configuration.functionSpecificConfigurationDescribe hook
message ConfigurationDescribe {
    // no parameters
}

message ConfigurationDescribeResponse {
    // EEPROM device identification
    string ident = 1;
    // EEPROM capacity
    fixed32 size = 2;
    // Supported operations
    string operations = 3;
}

// ConfigurationResponse to pass to Functionblock.ConfigurationResponse.functionSpecificConfigurationResponse hook
message ConfigurationResponse {
    oneof type {
        ConfigurationGetResponse get = 1;
        ConfigurationSetResponse set = 2;
        ConfigurationDescribeResponse describe = 3;
    }
}

// ============= FunctionControl =================

// EepromReadRequest for reading data from EEPROM
message EepromReadRequest {
    // Starting address to read from (0-511 for 512-byte EEPROM)
    fixed32 address = 1;
    // Number of bytes to read (1-512, but limited by address + length <= eeprom_size)
    fixed32 length = 2;
}

// EepromWriteRequest for writing data to EEPROM
message EepromWriteRequest {
    // Starting address to write to (0-511 for 512-byte EEPROM)
    fixed32 address = 1;
    // Binary data to write (max 512 bytes total)
    bytes data = 2;
}

// FunctionControlGet to pass to Functionblock.FunctionControl.functionSpecificFunctionControlGet hook
message FunctionControlGet {
    oneof operation {
        EepromReadRequest read = 1;
        // Status request (returns EEPROM status)
        bool status = 2;
    }
}

// FunctionControlSet to pass to Functionblock.FunctionControl.functionSpecificFunctionControlSet hook
message FunctionControlSet {
    oneof operation {
        EepromWriteRequest write = 1;
        // Erase entire EEPROM (sets all bytes to 0xFF)
        bool erase = 2;
    }
}

// EepromReadResponse containing read data
message EepromReadResponse {
    // Starting address that was read
    fixed32 address = 1;
    // Binary data read from EEPROM
    bytes data = 2;
    // Actual number of bytes read
    fixed32 bytes_read = 3;
}

// EepromWriteResponse confirming write operation
message EepromWriteResponse {
    // Starting address that was written
    fixed32 address = 1;
    // Number of bytes successfully written
    fixed32 bytes_written = 2;
}

// EepromStatusResponse providing EEPROM status
message EepromStatusResponse {
    // Total EEPROM size in bytes
    fixed32 total_size = 1;
    // Available/free bytes
    fixed32 available_bytes = 2;
    // Write protection status
    bool write_protected = 3;
    // Last operation status (true = success, false = error)
    bool last_operation_success = 4;
    // Error code (0 = no error)
    fixed32 error_code = 5;
    // actual block size
    fixed32 block_size = 6;
}

// FunctionControlGetResponse to pass to Functionblock.FunctionControlResponse.functionSpecificControlGet hook
message FunctionControlGetResponse {
    oneof result {
        EepromReadResponse read_response = 1;
        EepromStatusResponse status_response = 2;
    }
}

// FunctionControlSetResponse to pass to Functionblock.FunctionControlResponse.functionSpecificControlSet hook
message FunctionControlSetResponse {
    oneof result {
        EepromWriteResponse write_response = 1;
        // Erase confirmation
        bool erase_completed = 2;
    }
}

// ============= StreamControl ==================

// only used for monitoring EEPROM access operations
// included for security auditing purposes

// StreamControlStart to pass to Functionblock.StreamControlStart.functionSpecificStreamControlStart hook
message StreamControlStart {
    // Enable monitoring of EEPROM access operations
    bool monitor_access = 1;
    // Sample interval in milliseconds for monitoring (0 = disable periodic monitoring)
    fixed32 sample_interval_ms = 2;
}

// EepromAccessEvent for streaming EEPROM access events
message EepromAccessEvent {
    // Timestamp when the access occurred (microseconds since device start)
    fixed64 timestamp = 1;
    // Type of access: 0=read, 1=write, 2=erase
    fixed32 access_type = 2;
    // Address accessed
    fixed32 address = 3;
    // Number of bytes involved in the operation
    fixed32 byte_count = 4;
    // Success status of the operation
    bool success = 5;
}

// StreamData to pass to Functionblock.StreamData.functionSpecificStreamData hook
message StreamData {
    // List of EEPROM access events
    repeated EepromAccessEvent access_events = 1;
}